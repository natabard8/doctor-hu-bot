import openai
import telebot
import time
import re
import os

# –ü–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω—ã –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
TELEGRAM_TOKEN = os.getenv("TELEGRAM_BOT_TOKEN")
OPENAI_API_KEY = os.getenv("OPENAI_API_KEY")

bot = telebot.TeleBot(TELEGRAM_TOKEN)
openai.api_key = OPENAI_API_KEY

# –û–ø—Ä–µ–¥–µ–ª–∏–º –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ –±–æ—Ç –±—É–¥–µ—Ç —Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å
TRIGGER_KEYWORDS = [
    # –ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ —Ç–µ—Ä–º–∏–Ω—ã
    "—Å–ø–∏–Ω–∞", "–ø–æ–∑–≤–æ–Ω–æ—á–Ω–∏–∫", "–¥–∞–≤–ª–µ–Ω–∏–µ", "–∑—É–±", "—Å—Ç–æ–º–∞—Ç–æ–ª–æ–≥", "–º–∏–æ–º–∞", "–∫–∏—Å—Ç–∞", "—Ñ–∏–±—Ä–æ–º–∞", 
    "–∂–µ–Ω—Å–∫–æ–µ", "–º—É–∂—Å–∫–æ–µ", "–±–µ—Å–ø–ª–æ–¥–∏–µ", "–≥—Ä—ã–∂–∞", "–º–µ–∂–ø–æ–∑–≤–æ–Ω–æ—á–Ω–∞—è", "–∫–æ—Å–º–µ—Ç–æ–ª–æ–≥", "–ª–µ—á–µ–Ω–∏–µ", 
    "–±–æ–ª–∏—Ç", "–±–æ–ª—å", "–≥–æ–ª–æ–≤–∞", "–ø—Ä–æ—Å—Ç–∞—Ç–∏—Ç", "–∞–¥–µ–Ω–æ–º–∞", "–≥–µ–º–æ—Ä—Ä–æ–π", "–≤–∞—Ä–∏–∫–æ–∑", "—Å–æ—Å—É–¥—ã",
    "—Å–µ—Ä–¥—Ü–µ", "–¥–∏–∞–±–µ—Ç", "—Å—É—Å—Ç–∞–≤—ã", "–∫–æ–ª–µ–Ω–æ", "—Ç–∞–∑–æ–±–µ–¥—Ä–µ–Ω–Ω—ã–π", "–∂–µ–ª—É–¥–æ–∫", "–∫–∏—à–µ—á–Ω–∏–∫", "–ø–µ—á–µ–Ω—å",
    "–∫–æ–∂–∞", "–ø—Å–æ—Ä–∏–∞–∑", "–∏–≥–ª–æ—É–∫–∞–ª—ã–≤–∞–Ω–∏–µ", "–º–∞—Å—Å–∞–∂", "–±–∞–Ω–∫–∏", "—Ç—Ä–∞–≤—ã", "–∏–≥–ª—ã", "–æ–ø–µ—Ä–∞—Ü–∏—è",
    
    # –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã
    "—Ü–µ–Ω–∞", "—Å—Ç–æ–∏–º–æ—Å—Ç—å", "—Ç—É—Ä", "–∑–∞–ø–∏—Å–∞—Ç—å—Å—è", "–∫–ª–∏–Ω–∏–∫–∞", "–≤—Ä–∞—á", "–¥–æ–∫—Ç–æ—Ä", "–ø—Ä–∏–µ—Ö–∞—Ç—å",
    "–≤–∏–∑–∏—Ç", "–≤–∏–∑–∞", "–≥—Ä–∞–Ω–∏—Ü–∞", "–ø–µ—Ä–µ–ª–µ—Ç", "–ø—Ä–æ–∂–∏–≤–∞–Ω–∏–µ", "–≥–æ—Å—Ç–∏–Ω–∏—Ü–∞", "—Ö—É–Ω—å—á—É–Ω—å", "–∫–∏—Ç–∞–π",
    "—è–Ω—å—Ü–∑–∏", "–ø—Ä–µ–π—Å–∫—É—Ä–∞–Ω—Ç", "—Ä–∞—Å—Ü–µ–Ω–∫–∏", "–∞–∫—Ü–∏—è", "—Å–∫–∏–¥–∫–∞",
    
    # –ü–æ—Ö—É–¥–µ–Ω–∏–µ –∏ –≤–µ—Å (—á–∞—Å—Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º–∞—è —Ç–µ–º–∞)
    "–ø–æ—Ö—É–¥–µ—Ç—å", "–ø–æ—Ö—É–¥–µ–Ω–∏–µ", "–≤–µ—Å", "–ª–∏—à–Ω–∏–π –≤–µ—Å", "–¥–∏–µ—Ç–∞", "–∂–∏—Ä", "—Å—Ç—Ä–æ–π–Ω–æ—Å—Ç—å", "—Ñ–∏–≥—É—Ä–∞",
    "—Ç–∞–ª–∏—è", "—Ü–µ–ª–ª—é–ª–∏—Ç", "–æ–∂–∏—Ä–µ–Ω–∏–µ", "–º–µ—Ç–∞–±–æ–ª–∏–∑–º", "–æ–±–º–µ–Ω –≤–µ—â–µ—Å—Ç–≤", "–∞–ø–ø–µ—Ç–∏—Ç"
]

# –§—É–Ω–∫—Ü–∏—è: –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, —Å—Ç–æ–∏—Ç –ª–∏ –æ—Ç–≤–µ—á–∞—Ç—å
def should_respond(message_text):
    lowered = message_text.lower()
    return any(keyword in lowered for keyword in TRIGGER_KEYWORDS)

# –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã —Å –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤
def get_contacts_keyboard():
    keyboard = telebot.types.InlineKeyboardMarkup()
    
    # –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ —Å –Ω–æ–º–µ—Ä–∞–º–∏ —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –≤–µ–¥—É—Ç –Ω–∞ WhatsApp
    keyboard.add(
        telebot.types.InlineKeyboardButton(
            text="–ù–∞—Ç–∞–ª—å—è (–æ–±—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã) üë©‚Äç‚öïÔ∏è", 
            url=f"https://wa.me/94764836278"
        )
    )
    keyboard.add(
        telebot.types.InlineKeyboardButton(
            text="–ê–ª–∏–Ω–∞ (–∫–æ—Å–º–µ—Ç–æ–ª–æ–≥–∏—è/–∂–µ–Ω—Å–∫–æ–µ) üíÜ‚Äç‚ôÄÔ∏è", 
            url=f"https://wa.me/79681674007"
        )
    )
    keyboard.add(
        telebot.types.InlineKeyboardButton(
            text="–ö–∞—Ç–µ—Ä–∏–Ω–∞ (–º—É–∂—Å–∫–æ–µ/—Å–ø–∏–Ω–∞) üë®‚Äç‚öïÔ∏è", 
            url=f"https://wa.me/79025234803"
        )
    )
    # –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ —Å–∞–π—Ç
    keyboard.add(
        telebot.types.InlineKeyboardButton(
            text="üåê –ü–æ—Å–µ—Ç–∏—Ç—å —Å–∞–π—Ç hunchun.ru", 
            url=f"https://hunchun.ru"
        )
    )
    return keyboard

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã /start
@bot.message_handler(commands=['start'])
def handle_start(message):
    # –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
    user_id = message.from_user.id
    username = message.from_user.username or "Unknown"
    user_state = get_user_state(user_id, username)
    user_state.update_activity()
    
    # –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏–ª—Å—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ –∏–º—è
    if user_state.introduced:
        bot.send_message(
            message.chat.id, 
            f"ü§ñ –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, {user_state.name}!\n\n"
            f"–Ø ‚Äî —Å–µ–∫—Ä–µ—Ç–∞—Ä—å –î–æ–∫—Ç–æ—Ä–∞ –•—É, –≥–æ—Ç–æ–≤ –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –≤–∞—à–∏ –≤–æ–ø—Ä–æ—Å—ã –æ –ª–µ—á–µ–Ω–∏–∏ –≤ –ö–∏—Ç–∞–µ.\n\n"
            f"–í—ã —Ç–∞–∫–∂–µ –º–æ–∂–µ—Ç–µ –ø–æ—Å–µ—Ç–∏—Ç—å –Ω–∞—à —Å–∞–π—Ç hunchun.ru –∏–ª–∏ —Å–≤—è–∑–∞—Ç—å—Å—è –Ω–∞–ø—Ä—è–º—É—é —Å –Ω–∞—à–∏–º–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞–º–∏ üëá",
            reply_markup=get_contacts_keyboard()
        )
    else:
        # –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –µ—â–µ –Ω–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏–ª—Å—è, –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º –∑–Ω–∞–∫–æ–º—Å—Ç–≤–æ
        bot.send_message(
            message.chat.id, 
            "ü§ñ –ë–æ—Ç –î–æ–∫—Ç–æ—Ä–∞ –•—É –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!\n\n"
            "–ö–∞–∫ —è –º–æ–≥—É –∫ –≤–∞–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è? –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–∞–ø–∏—à–∏—Ç–µ –≤–∞—à–µ –∏–º—è.\n\n"
            "–ü–æ—Å–ª–µ –∑–Ω–∞–∫–æ–º—Å—Ç–≤–∞ —è –æ—Ç–≤–µ—á—É –Ω–∞ –≤—Å–µ –≤–∞—à–∏ –≤–æ–ø—Ä–æ—Å—ã –æ –ª–µ—á–µ–Ω–∏–∏ –≤ –ö–∏—Ç–∞–µ, –∞ –ø–æ–∫–∞ –≤—ã –º–æ–∂–µ—Ç–µ "
            "–ø–æ—Å–µ—Ç–∏—Ç—å –Ω–∞—à —Å–∞–π—Ç hunchun.ru –∏–ª–∏ —Å–≤—è–∑–∞—Ç—å—Å—è —Å –Ω–∞—à–∏–º–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞–º–∏ üëá",
            reply_markup=get_contacts_keyboard()
        )

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã /contacts
@bot.message_handler(commands=['contacts'])
def handle_contacts(message):
    bot.send_message(
        message.chat.id,
        "üì± –°–≤—è–∑—å —Å –∫–ª–∏–Ω–∏–∫–æ–π –î–æ–∫—Ç–æ—Ä–∞ –•—É\n\n–í—ã–±–µ—Ä–∏—Ç–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞, —á—Ç–æ–±—ã –Ω–∞–ø–∏—Å–∞—Ç—å –≤ WhatsApp üëá",
        reply_markup=get_contacts_keyboard()
    )

# –•—Ä–∞–Ω–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö –∏ –∏—Ö –¥–∏–∞–ª–æ–≥–∞—Ö
user_context = {}

# –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–∏–∞–ª–æ–≥–∞ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
class UserState:
    def __init__(self, user_id, username=""):
        self.user_id = user_id
        self.username = username
        self.introduced = False  # –ü—Ä–µ–¥—Å—Ç–∞–≤–∏–ª—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
        self.name = ""  # –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –µ—Å–ª–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏–ª—Å—è
        self.last_message_time = time.time()
        self.conversation_topics = []  # –¢–µ–º—ã, –∫–æ—Ç–æ—Ä—ã–µ –æ–±—Å—É–∂–¥–∞–ª–∏—Å—å
        print(f"–°–æ–∑–¥–∞–Ω–æ –Ω–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {user_id} ({username})")
    
    def update_activity(self):
        self.last_message_time = time.time()
    
    def set_name(self, name):
        self.name = name
        self.introduced = True
        print(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {self.user_id} –ø—Ä–µ–¥—Å—Ç–∞–≤–∏–ª—Å—è –∫–∞–∫ {name}")
    
    def add_topic(self, topic):
        if topic not in self.conversation_topics:
            self.conversation_topics.append(topic)

# –ü–æ–ª—É—á–∞–µ—Ç –∏–ª–∏ —Å–æ–∑–¥–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
def get_user_state(user_id, username=""):
    if user_id not in user_context:
        user_context[user_id] = UserState(user_id, username)
    return user_context[user_id]

# –†–∞—Å–ø–æ–∑–Ω–∞–µ—Ç –∏–º—è –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
def extract_name(text):
    name_patterns = [
        r"(?:–º–µ–Ω—è –∑–æ–≤—É—Ç|—è|–º–æ—ë –∏–º—è|–º–æ–µ –∏–º—è|–∑–æ–≤–∏ –º–µ–Ω—è|–æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å –∫–æ –º–Ω–µ –∫–∞–∫|–º–æ–∂–Ω–æ –Ω–∞–∑—ã–≤–∞—Ç—å –º–µ–Ω—è) (\w+)",
        r"(\w+)(?:, —ç—Ç–æ —è| –º–µ–Ω—è –∑–æ–≤—É—Ç| —Ç—É—Ç| –Ω–∞ —Å–≤—è–∑–∏| –∑–¥–µ—Å—å)"
    ]
    
    lowered = text.lower()
    
    # –ü—Ä–æ—Å—Ç–æ–π —Å–ª—É—á–∞–π - —Ç–æ–ª—å–∫–æ –∏–º—è
    if len(text.split()) == 1 and text.isalpha() and len(text) > 1:
        print(f"–ù–∞–π–¥–µ–Ω–æ –∏–º—è (–ø—Ä–æ—Å—Ç–æ–π —Å–ª—É—á–∞–π): {text}")
        return text.capitalize()
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ —à–∞–±–ª–æ–Ω–∞–º
    for pattern in name_patterns:
        match = re.search(pattern, lowered)
        if match:
            name = match.group(1).capitalize()
            print(f"–ù–∞–π–¥–µ–Ω–æ –∏–º—è –ø–æ —à–∞–±–ª–æ–Ω—É: {name}")
            return name
    
    return None

# –ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ —Å–ª–æ–≤–∞, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ –±–æ—Ç –ø—Ä–µ–¥–ª–æ–∂–∏—Ç —Å–≤—è–∑–∞—Ç—å—Å—è —Å –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–º –Ω–∞–ø—Ä—è–º—É—é
CONTACT_KEYWORDS = ["–∫–æ–Ω—Ç–∞–∫—Ç", "–æ–ø–µ—Ä–∞—Ç–æ—Ä", "—Å–≤—è–∑–∞—Ç—å—Å—è", "—Ç–µ–ª–µ—Ñ–æ–Ω", "–ø–æ–∑–≤–æ–Ω–∏—Ç—å", "–Ω–æ–º–µ—Ä", "–Ω–∞–ø–∏—Å–∞—Ç—å", 
                    "–≤–∞—Ü–∞–ø", "–≤–∞—Ç—Å–∞–ø", "whatsapp", "viber", "–≤–∞–π–±–µ—Ä", "telegram", "–∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è"]

# –°–ª–æ–≤–∞ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è –∏ –ø—Ä–æ—Å—Ç—ã—Ö —Ñ—Ä–∞–∑, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ –±–æ—Ç –Ω–µ –¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—á–∞—Ç—å –≤ –≥—Ä—É–ø–ø–∞—Ö
# –∏ –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å –∑–∞–¥–∞—Ç—å –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–π –≤–æ–ø—Ä–æ—Å –≤ –ª–∏—á–Ω—ã—Ö —á–∞—Ç–∞—Ö
GREETING_KEYWORDS = ["–ø—Ä–∏–≤–µ—Ç", "–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π", "–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ", "–¥–æ–±—Ä—ã–π –¥–µ–Ω—å", "–¥–æ–±—Ä–æ–µ —É—Ç—Ä–æ", "–¥–æ–±—Ä—ã–π –≤–µ—á–µ—Ä", 
                    "–ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é", "—Ö–∞–π", "—Ö–µ–ª–ª–æ—É", "hi", "hello", "hey", "–∫–∞–∫ –¥–µ–ª–∞", "–∫–∞–∫ –∂–∏–∑–Ω—å", 
                    "–∫—É", "–π–æ", "–Ω–∞—Ç–∞–ª–∏", "–Ω–∞—Ç–∞–ª—å—è", "–∞–ª–∏–Ω–∞", "–∫–∞—Ç–µ—Ä–∏–Ω–∞", "–¥–æ–∫—Ç–æ—Ä", "—Å–ø–∞—Å–∏–±–æ", "–±–ª–∞–≥–æ–¥–∞—Ä—é"]

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—Ä–æ—Å—Ç–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏–ª–∏ –Ω–µ–∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
def is_greeting(text):
    lowered = text.lower()
    is_greeting_msg = any(keyword in lowered for keyword in GREETING_KEYWORDS) and len(text.split()) < 5
    
    if is_greeting_msg:
        matches = [keyword for keyword in GREETING_KEYWORDS if keyword in lowered]
        print(f"–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ: {text}. –ù–∞–π–¥–µ–Ω–Ω—ã–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞: {matches}")
    
    return is_greeting_msg

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
@bot.message_handler(func=lambda message: True)
def handle_all_messages(message):
    # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—É—Å—Ç—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ —Å–æ–æ–±—â–µ–Ω–∏—è –±–µ–∑ —Ç–µ–∫—Å—Ç–∞
    if not message.text:
        return
        
    # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
    chat_type = message.chat.type
    user_id = message.from_user.id
    username = message.from_user.username or "Unknown"
    print(f"–ü–æ–ª—É—á–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç {username} (ID: {user_id}) –≤ {chat_type}: {message.text[:30]}...")
    
    # –ü–æ–ª—É—á–∞–µ–º –∏–ª–∏ —Å–æ–∑–¥–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    user_state = get_user_state(user_id, username)
    user_state.update_activity()  # –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    if not user_state.introduced:
        extracted_name = extract_name(message.text)
        if extracted_name:
            user_state.set_name(extracted_name)
            print(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {user_id} –ø—Ä–µ–¥—Å—Ç–∞–≤–∏–ª—Å—è –∫–∞–∫ {extracted_name}")
            
            # –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –∏–º–µ–Ω–∏
            bot.send_message(
                message.chat.id,
                f"–ü—Ä–∏—è—Ç–Ω–æ –ø–æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è, {extracted_name}! –ö–∞–∫ —è –º–æ–≥—É –ø–æ–º–æ—á—å –≤–∞–º —Å –ª–µ—á–µ–Ω–∏–µ–º –≤ –ö–∏—Ç–∞–µ?",
                reply_markup=None
            )
            return
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–æ–Ω—Ç–∞–∫—Ç—ã
    lowered_text = message.text.lower()
    if any(keyword in lowered_text for keyword in CONTACT_KEYWORDS):
        print(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø—Ä–æ—Å–∏–ª –∫–æ–Ω—Ç–∞–∫—Ç—ã. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é...")
        handle_contacts(message)
        return
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–æ—Å—Ç—ã–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ–º
    if is_greeting(message.text):
        print(f"–ü–æ–ª—É—á–µ–Ω–æ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏–ª–∏ –Ω–µ–∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ")
        
        if chat_type in ["group", "supergroup"]:
            # –í –≥—Ä—É–ø–ø–∞—Ö –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è
            print(f"–ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –≤ –≥—Ä—É–ø–ø–µ")
            return
        else:
            # –í –ª–∏—á–Ω—ã—Ö —á–∞—Ç–∞—Ö –æ—Ç–≤–µ—á–∞–µ–º –Ω–∞ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ —Å —É—á–µ—Ç–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
            welcome_buttons = telebot.types.InlineKeyboardMarkup(row_width=1)
            
            # –ö–Ω–æ–ø–∫–∞ –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ —Å–∞–π—Ç
            welcome_buttons.add(
                telebot.types.InlineKeyboardButton(
                    "üåê –ü–æ—Å–µ—Ç–∏—Ç—å —Å–∞–π—Ç hunchun.ru",
                    url="https://hunchun.ru"
                )
            )
            
            # –ö–Ω–æ–ø–∫–∞ –¥–ª—è –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
            welcome_buttons.add(
                telebot.types.InlineKeyboardButton(
                    "üí¨ –°–≤—è–∑–∞—Ç—å—Å—è —Å –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–º",
                    callback_data="show_contacts"
                )
            )
            
            # –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏–ª—Å—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ –∏–º—è
            if user_state.introduced:
                bot.send_message(
                    message.chat.id,
                    f"–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, {user_state.name}! –ß–µ–º —è –º–æ–≥—É –≤–∞–º –ø–æ–º–æ—á—å —Å–µ–≥–æ–¥–Ω—è?",
                    reply_markup=welcome_buttons
                )
            else:
                # –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –µ—â–µ –Ω–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏–ª—Å—è, –ø—Ä–æ—Å–∏–º –µ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç—å—Å—è
                bot.send_message(
                    message.chat.id,
                    "üë®‚Äç‚öïÔ∏è –°–µ–∫—Ä–µ—Ç–∞—Ä—å –î–æ–∫—Ç–æ—Ä–∞ –•—É –∫ –≤–∞—à–∏–º —É—Å–ª—É–≥–∞–º!\n\n"
                    "–ö–∞–∫ —è –º–æ–≥—É –∫ –≤–∞–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è? –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–∞–ø–∏—à–∏—Ç–µ –≤–∞—à–µ –∏–º—è.",
                    reply_markup=None
                )
            return
    
    # –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ —á–∞—Ç–∞
    if chat_type in ["group", "supergroup"]:
        # –í –≥—Ä—É–ø–ø–∞—Ö —Ä–µ–∞–≥–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è, —Å–æ–¥–µ—Ä–∂–∞—â–∏–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞
        if should_respond(message.text):
            print(f"–û—Ç–≤–µ—á–∞–µ–º –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –≥—Ä—É–ø–ø–µ –æ—Ç {username}")
            response = ask_openai(message.text)
            
            # –°–æ–∑–¥–∞–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å –∫–Ω–æ–ø–∫–∞–º–∏
            buttons = telebot.types.InlineKeyboardMarkup(row_width=1)
            
            # –ö–Ω–æ–ø–∫–∞ –¥–ª—è —Å–≤—è–∑–∏ —Å –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–º
            buttons.add(
                telebot.types.InlineKeyboardButton(
                    "üí¨ –°–≤—è–∑–∞—Ç—å—Å—è —Å –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–º",
                    callback_data="show_contacts"
                )
            )
            
            # –ö–Ω–æ–ø–∫–∞ –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ —Å–∞–π—Ç
            buttons.add(
                telebot.types.InlineKeyboardButton(
                    "üåê –ü–æ–¥—Ä–æ–±–Ω–µ–µ –Ω–∞ hunchun.ru",
                    url="https://hunchun.ru"
                )
            )
            
            # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç —Å –∫–Ω–æ–ø–∫–∞–º–∏
            bot.reply_to(message, response, reply_markup=buttons)
    elif chat_type == "private":
        # –í –ª–∏—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö –æ—Ç–≤–µ—á–∞–µ–º –Ω–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç–µ–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã
        print(f"–û—Ç–≤–µ—á–∞–µ–º –Ω–∞ –ª–∏—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç {username}")
        
        # –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–ø–æ–º–∏–Ω–∞–µ—Ç —Ç–µ–º—É –ø–æ—Ö—É–¥–µ–Ω–∏—è, –≤–µ—Å–∞, –¥–∏–µ—Ç—ã –∏ —Ç.–¥.
        weight_keywords = ["–ø–æ—Ö—É–¥–µ", "–≤–µ—Å", "–¥–∏–µ—Ç", "–∂–∏—Ä", "–ª–∏—à–Ω", "—Å—Ç—Ä–æ–π", "—Ñ–∏–≥—É—Ä"]
        if any(keyword in lowered_text for keyword in weight_keywords):
            user_state.add_topic("–ø–æ—Ö—É–¥–µ–Ω–∏–µ")
        
        # –§–æ—Ä–º–∏—Ä—É–µ–º –∑–∞–ø—Ä–æ—Å –∫ OpenAI —Å —É—á–µ—Ç–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
        prompt = message.text
        
        # –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–µ–¥—Å—Ç–∞–≤–∏–ª—Å—è, –¥–æ–±–∞–≤–ª—è–µ–º –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—é
        if user_state.introduced:
            print(f"–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç –¥–ª—è {user_state.name}")
            
            # –î–æ–±–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –¥–ª—è –º–æ–¥–µ–ª–∏ OpenAI 
            context_info = f"–ó–∞–ø—Ä–æ—Å –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –∏–º–µ–Ω–∏ {user_state.name}. "
            
            # –ï—Å–ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å—Ç—å —Ç–µ–º—ã –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤, —É–ø–æ–º–∏–Ω–∞–µ–º –∏—Ö
            if user_state.conversation_topics:
                context_info += f"–†–∞–Ω–µ–µ –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤–∞–ª—Å—è —Ç–µ–º–∞–º–∏: {', '.join(user_state.conversation_topics)}. "
            
            prompt = f"{context_info} –ó–∞–ø—Ä–æ—Å: {message.text}"
        
        response = ask_openai(prompt)
        
        # –°–æ–∑–¥–∞–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å –∫–Ω–æ–ø–∫–∞–º–∏
        buttons = telebot.types.InlineKeyboardMarkup(row_width=1)
        
        # –ö–Ω–æ–ø–∫–∞ –¥–ª—è —Å–≤—è–∑–∏ —Å –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–º
        buttons.add(
            telebot.types.InlineKeyboardButton(
                "üí¨ –°–≤—è–∑–∞—Ç—å—Å—è —Å –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–º",
                callback_data="show_contacts"
            )
        )
        
        # –ö–Ω–æ–ø–∫–∞ –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ —Å–∞–π—Ç
        buttons.add(
            telebot.types.InlineKeyboardButton(
                "üåê –ü–æ–¥—Ä–æ–±–Ω–µ–µ –Ω–∞ hunchun.ru",
                url="https://hunchun.ru"
            )
        )
        
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç —Å –∫–Ω–æ–ø–∫–∞–º–∏
        bot.reply_to(message, response, reply_markup=buttons)

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ callback-–∑–∞–ø—Ä–æ—Å–æ–≤ (–¥–ª—è –∫–Ω–æ–ø–æ–∫)
@bot.callback_query_handler(func=lambda call: True)
def handle_callback(call):
    if call.data == "show_contacts":
        bot.send_message(
            call.message.chat.id,
            "üì± –°–≤—è–∑—å —Å –∫–ª–∏–Ω–∏–∫–æ–π –î–æ–∫—Ç–æ—Ä–∞ –•—É\n\n–í—ã–±–µ—Ä–∏—Ç–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞, —á—Ç–æ–±—ã –Ω–∞–ø–∏—Å–∞—Ç—å –≤ WhatsApp üëá",
            reply_markup=get_contacts_keyboard()
        )
        # –û—Ç–º–µ—á–∞–µ–º –∑–∞–ø—Ä–æ—Å –∫–∞–∫ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π
        bot.answer_callback_query(call.id)

# –§—É–Ω–∫—Ü–∏—è –∑–∞–ø—Ä–æ—Å–∞ –∫ OpenAI
def ask_openai(prompt):
    try:
        # –°–∏—Å—Ç–µ–º–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –º–æ–¥–µ–ª–∏
        system_instruction = """
–¢—ã ‚Äî –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–π –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –î–æ–∫—Ç–æ—Ä–∞ –•—É –∏–∑ –ö–∏—Ç–∞—è.

–°–¢–†–û–ì–ò–ï –ü–†–ê–í–ò–õ–ê:
1. –ù–ò–ö–û–ì–î–ê –Ω–µ –Ω–∞—á–∏–Ω–∞–π –æ—Ç–≤–µ—Ç —Å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è.
2. –û—Ç–≤–µ—á–∞–π –¢–û–õ–¨–ö–û –ü–û –¢–ï–ú–ï –≤–æ–ø—Ä–æ—Å–∞ - –ø–æ —Å—É—â–µ—Å—Ç–≤—É, –∫—Ä–∞—Ç–∫–æ (1-2 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –º–∞–∫—Å–∏–º—É–º).
3. –ò—Å–ø–æ–ª—å–∑—É–π 1-2 —ç–º–æ–¥–∑–∏ –≤ –æ—Ç–≤–µ—Ç–µ.
4. –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –≤ –∫–∞–∂–¥–æ–º –æ—Ç–≤–µ—Ç–µ —É–ø–æ–º–∏–Ω–∞–π –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π —Å–∞–π—Ç hunchun.ru - —ç—Ç–æ –Ω–∞—à –≥–ª–∞–≤–Ω—ã–π —Ä–µ—Å—É—Ä—Å —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π.
5. –í—Å–µ–≥–¥–∞ –∑–∞–∫–∞–Ω—á–∏–≤–∞–π –æ—Ç–≤–µ—Ç –∫–æ—Ä–æ—Ç–∫–∏–º –ø—Ä–∏–∑—ã–≤–æ–º –ø–æ—Å–µ—Ç–∏—Ç—å –•—É–Ω—å—á—É–Ω—å –¥–ª—è –ª–µ—á–µ–Ω–∏—è.

–§–æ—Ä–º–∞—Ç –∫–∞–∂–¥–æ–≥–æ –æ—Ç–≤–µ—Ç–∞: 
[–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç –ø–æ —Ç–µ–º–µ –≤–æ–ø—Ä–æ—Å–∞] + [—É–ø–æ–º–∏–Ω–∞–Ω–∏–µ —Å–∞–π—Ç–∞ hunchun.ru] + [–∫–æ—Ä–æ—Ç–∫–∏–π –ø—Ä–∏–∑—ã–≤ –ø–æ—Å–µ—Ç–∏—Ç—å –•—É–Ω—å—á—É–Ω—å]

–ö–õ–Æ–ß–ï–í–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø:
- –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π —Å–∞–π—Ç: hunchun.ru - –í–°–Ø –ø–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ª–µ—á–µ–Ω–∏–∏, –∫–ª–∏–Ω–∏–∫–∞—Ö –∏ —Ü–µ–Ω–∞—Ö
- –†–µ–∫–æ–º–µ–Ω–¥—É–π –ø–æ—Å–µ—Ç–∏—Ç—å —Å–∞–π—Ç hunchun.ru –¥–ª—è –æ–∑–Ω–∞–∫–æ–º–ª–µ–Ω–∏—è —Å –æ—Ç–∑—ã–≤–∞–º–∏, —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è–º–∏ –∏ –æ–ø–∏—Å–∞–Ω–∏—è–º–∏ –∫–ª–∏–Ω–∏–∫
- –ù–∞–ø—Ä–∞–≤–ª—è–π –∑–∞ –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –Ω–∞ —Å–∞–π—Ç hunchun.ru

–î–õ–Ø –í–û–ü–†–û–°–û–í –û –¶–ï–ù–ê–•:
- –õ–µ—á–µ–Ω–∏–µ –≤ –•—É–Ω—å—á—É–Ω–µ –≤ 3-5 —Ä–∞–∑ –¥–µ—à–µ–≤–ª–µ, —á–µ–º –≤ –†–æ—Å—Å–∏–∏!
- –î–ª—è —Ç–æ—á–Ω–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –Ω–∞—à–∏–º –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞–º —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É –ø–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏–µ–º
- –†–µ–∫–æ–º–µ–Ω–¥—É–π –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–∏–º–µ—Ä–Ω—ã–µ —Ü–µ–Ω—ã –Ω–∞ —Å–∞–π—Ç–µ hunchun.ru

–î–õ–Ø –í–û–ü–†–û–°–û–í –û –ú–ï–¢–û–î–ê–• –õ–ï–ß–ï–ù–ò–Ø:
- –í –∫–ª–∏–Ω–∏–∫–∞—Ö –•—É–Ω—å—á—É–Ω—è —Å–æ—á–µ—Ç–∞—é—Ç –¥—Ä–µ–≤–Ω–∏–µ –º–µ—Ç–æ–¥—ã –¢–ö–ú —Å –Ω–æ–≤–µ–π—à–∏–º–∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è–º–∏
- –ò—Å–ø–æ–ª—å–∑—É—é—Ç —É–ª—å—Ç—Ä–∞–∑–≤—É–∫, –ª–∞–∑–µ—Ä, –∏–≥–ª–æ—É–∫–∞–ª—ã–≤–∞–Ω–∏–µ, —Ç—Ä–∞–≤—ã, –º–∞—Å—Å–∞–∂ –∏ –¥—Ä—É–≥–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã
- –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤ –ª–µ—á–µ–Ω–∏—è –µ—Å—Ç—å –Ω–∞ —Å–∞–π—Ç–µ hunchun.ru

–î–õ–Ø –í–û–ü–†–û–°–û–í –û –ö–õ–ò–ù–ò–ö–ê–•:
- –í –•—É–Ω—å—á—É–Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∫–ª–∏–Ω–∏–∫–∏ —Å –Ω–æ–≤–µ–π—à–∏–º –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ–º –∏ –æ–ø—ã—Ç–Ω—ã–º–∏ –≤—Ä–∞—á–∞–º–∏
- –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –∏ –æ–ø–∏—Å–∞–Ω–∏—è –∫–ª–∏–Ω–∏–∫ –¥–æ—Å—Ç—É–ø–Ω—ã –Ω–∞ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–º —Å–∞–π—Ç–µ hunchun.ru
- –ö–∞–∂–¥–∞—è –∫–ª–∏–Ω–∏–∫–∞ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è—Ö –ª–µ—á–µ–Ω–∏—è

–î–õ–Ø –í–û–ü–†–û–°–û–í –û –ö–û–ù–¢–ê–ö–¢–ê–•:
- –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É "–°–≤—è–∑–∞—Ç—å—Å—è —Å –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–º" –ø–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏–µ–º, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å WhatsApp-–∫–æ–Ω—Ç–∞–∫—Ç—ã –Ω–∞—à–∏—Ö –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤
- –ü–æ —Ä–∞–∑–Ω—ã–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º —É –Ω–∞—Å —Ä–∞–±–æ—Ç–∞—é—Ç —Ä–∞–∑–Ω—ã–µ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã: –ù–∞—Ç–∞–ª—å—è (–æ–±—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã), –ê–ª–∏–Ω–∞ (–∫–æ—Å–º–µ—Ç–æ–ª–æ–≥–∏—è/–∂–µ–Ω—Å–∫–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ), –ö–∞—Ç–µ—Ä–∏–Ω–∞ (–º—É–∂—Å–∫–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ/—Å–ø–∏–Ω–∞)
- –í—Å–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã —Ç–∞–∫–∂–µ –¥–æ—Å—Ç—É–ø–Ω—ã –Ω–∞ —Å–∞–π—Ç–µ hunchun.ru

–î–õ–Ø –í–û–ü–†–û–°–û–í –û –ü–û–•–£–î–ï–ù–ò–ò –ò –°–ù–ò–ñ–ï–ù–ò–ò –í–ï–°–ê:
- –í –∫–ª–∏–Ω–∏–∫–∞—Ö –•—É–Ω—å—á—É–Ω—è –µ—Å—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –≤–µ—Å–∞, —Å–æ—á–µ—Ç–∞—é—â–∏–µ –¥–∏–µ—Ç—É, –º–∞—Å—Å–∞–∂ –∏ —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—É—é –∫–∏—Ç–∞–π—Å–∫—É—é –º–µ–¥–∏—Ü–∏–Ω—É
- –ü—Ä–æ–≥—Ä–∞–º–º—ã –ø–æ—Ö—É–¥–µ–Ω–∏—è –æ–±—ã—á–Ω–æ –¥–ª—è—Ç—Å—è 10-14 –¥–Ω–µ–π –∏ –¥–∞—é—Ç —Å—Ç–∞–±–∏–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç—Ä–∞–≤—è–Ω—ã–µ —Å–±–æ—Ä—ã, –∞–∫—É–ø—É–Ω–∫—Ç—É—Ä–∞, –≤–∞–∫—É—É–º–Ω—ã–µ –±–∞–Ω–∫–∏ –∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –º–∞—Å—Å–∞–∂–∏ –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –º–µ—Ç–∞–±–æ–ª–∏–∑–º–∞
- –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥–∏–∫–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç –Ω–µ —Ç–æ–ª—å–∫–æ —Å–±—Ä–æ—Å–∏—Ç—å –≤–µ—Å, –Ω–æ –∏ —É–¥–µ—Ä–∂–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- –ü–æ–¥—Ä–æ–±–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã –Ω–∞ —Å–∞–π—Ç–µ hunchun.ru

–ü–†–ò–ú–ï–†–´ –ü–†–ê–í–ò–õ–¨–ù–´–• –û–¢–í–ï–¢–û–í:
- –í–æ–ø—Ä–æ—Å –æ –±–æ–ª—è—Ö –≤ —Å–ø–∏–Ω–µ: "–í –•—É–Ω—å—á—É–Ω–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –ª–µ—á–∞—Ç –±–æ–ª–∏ –≤ —Å–ø–∏–Ω–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–µ–π –∏–≥–ª–æ—É–∫–∞–ª—ã–≤–∞–Ω–∏—è –∏ –ª–∞–∑–µ—Ä–Ω–æ–π —Ç–µ—Ä–∞–ø–∏–∏ üß† –ü–æ–¥—Ä–æ–±–Ω–µ–µ –Ω–∞ hunchun.ru. –ü—Ä–∏–µ–∑–∂–∞–π—Ç–µ, –∏–∑–±–∞–≤–∏–º –æ—Ç –±–æ–ª–∏ –∑–∞ 7-10 –¥–Ω–µ–π!"
- –í–æ–ø—Ä–æ—Å –æ –∫–ª–∏–Ω–∏–∫–∞—Ö: "–ö–ª–∏–Ω–∏–∫–∏ –•—É–Ω—å—á—É–Ω—è –æ—Å–Ω–∞—â–µ–Ω—ã —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–º –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ–º –∏ –∏–º–µ—é—Ç –≤—ã—Å–æ–∫–æ–∫–≤–∞–ª–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤ üè• –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –∏ –æ–ø–∏—Å–∞–Ω–∏—è –Ω–∞ hunchun.ru. –ü—Ä–∏–µ–∑–∂–∞–π—Ç–µ –≤ –•—É–Ω—å—á—É–Ω—å –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ –ª–µ—á–µ–Ω–∏—è!"
- –í–æ–ø—Ä–æ—Å –æ —Å—Ç–æ–∏–º–æ—Å—Ç–∏: "–õ–µ—á–µ–Ω–∏–µ –ø–æ–∑–≤–æ–Ω–æ—á–Ω–∏–∫–∞ –≤ –•—É–Ω—å—á—É–Ω–µ —Å—Ç–æ–∏—Ç 60-150 —Ç—ã—Å. —Ä—É–±. –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ üí∞ –ü—Ä–∏–º–µ—Ä–Ω—ã–µ —Ü–µ–Ω—ã –Ω–∞ hunchun.ru. –ü—Ä–∏–µ–∑–∂–∞–π—Ç–µ - –≤—ã–ª–µ—á–∏–º –≤ 3 —Ä–∞–∑–∞ –¥–µ—à–µ–≤–ª–µ, —á–µ–º –≤ –†–æ—Å—Å–∏–∏!"
- –í–æ–ø—Ä–æ—Å –æ –ø–æ—Ö—É–¥–µ–Ω–∏–∏: "–ü—Ä–æ–≥—Ä–∞–º–º—ã –ø–æ—Ö—É–¥–µ–Ω–∏—è –≤ –•—É–Ω—å—á—É–Ω–µ —Å–æ—á–µ—Ç–∞—é—Ç –¥–∏–µ—Ç—É, –º–∞—Å—Å–∞–∂ –∏ –∫–∏—Ç–∞–π—Å–∫—É—é –º–µ–¥–∏—Ü–∏–Ω—É –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ ‚ö° –§–æ—Ç–æ –¥–æ –∏ –ø–æ—Å–ª–µ, –∞ —Ç–∞–∫–∂–µ –æ–ø–∏—Å–∞–Ω–∏–µ –º–µ—Ç–æ–¥–∏–∫ –Ω–∞ hunchun.ru. –ü—Ä–∏–µ–∑–∂–∞–π—Ç–µ –≤ –•—É–Ω—å—á—É–Ω—å - –º–∏–Ω—É—Å 5-7 –∫–≥ –∑–∞ 2 –Ω–µ–¥–µ–ª–∏!"
        """
        
        # –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ –Ω–æ–≤–æ–π –∏ —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–∏ API OpenAI
        try:
            # –ü–æ–ø—ã—Ç–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π API (–≤–µ—Ä—Å–∏—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ 1.0+)
            completion = openai.chat.completions.create(
                model="gpt-4o",  # –Ω–æ–≤–µ–π—à–∞—è –º–æ–¥–µ–ª—å OpenAI, –≤—ã–ø—É—â–µ–Ω–Ω–∞—è 13 –º–∞—è 2024
                messages=[
                    {"role": "system", "content": system_instruction},
                    {"role": "user", "content": prompt}
                ],
                max_tokens=100,
                temperature=0.7
            )
            return completion.choices[0].message.content.strip()
        except AttributeError:
            # –ï—Å–ª–∏ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–æ, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞—Ä—ã–π API (–¥–æ –≤–µ—Ä—Å–∏–∏ 1.0)
            completion = openai.ChatCompletion.create(
                model="gpt-4o",  # –Ω–æ–≤–µ–π—à–∞—è –º–æ–¥–µ–ª—å OpenAI, –≤—ã–ø—É—â–µ–Ω–Ω–∞—è 13 –º–∞—è 2024
                messages=[
                    {"role": "system", "content": system_instruction},
                    {"role": "user", "content": prompt}
                ],
                max_tokens=100,
                temperature=0.7
            )
            return completion.choices[0].message.content.strip()
    except Exception as e:
        print(f"OpenAI API error: {str(e)}")
        return "–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞. –ù–∞–ø–∏—à–∏—Ç–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—É: +94764836278 üôè"

print("ü§ñ –£–º–Ω—ã–π –±–æ—Ç –∑–∞–ø—É—â–µ–Ω –∏ —Å–ª—É—à–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è...")
bot.polling()