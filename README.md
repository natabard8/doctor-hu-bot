# Telegram Бот Доктора Ху

Умный Telegram-бот для медицинской консультации и привлечения клиентов в клиники Хуньчуня и Яньцзи (Китай).

## Функциональность

- Отвечает на вопросы о лечении в Китае, используя OpenAI API (GPT-4o)
- Работает в личных чатах и в группах
- В группах отвечает только на сообщения с медицинскими ключевыми словами
- Игнорирует приветствия и неинформативные сообщения в группах
- В личных чатах при приветствии предлагает задать вопрос по существу
- Дает краткие, информативные ответы в определенном формате
- Активно приглашает пользователей посетить Хуньчунь для лечения
- Добавляет к ответам кнопку "Связаться с оператором"
- Предоставляет WhatsApp-ссылки на контакты операторов по командам /start и /contacts
- Автоматически определяет запросы на контакты и показывает информацию операторов
- Сохраняет данные о пользователях в Google Sheets (если настроено)
- Уведомляет админа о новых запросах

## Доступные версии

В проекте доступны две версии бота:

1. **Python-версия** (bot.py) - упрощенная версия с основной функциональностью
2. **TypeScript-версия** (в папке server) - расширенная версия с полным набором функций

## Как запустить Python-версию

1. Убедитесь, что переменные окружения настроены:
   - `TELEGRAM_BOT_TOKEN`
   - `OPENAI_API_KEY`

2. Запустите бота через Replit Workflow:
   - Нажмите на вкладку "Start Python Bot" в панели Workflows
   - Или запустите команду `python bot.py` в терминале

## Как запустить TypeScript-версию

1. Убедитесь, что все переменные окружения настроены:
   - `TELEGRAM_BOT_TOKEN`
   - `OPENAI_API_KEY`
   - `ADMIN_TELEGRAM_ID` (для уведомлений)
   - `GOOGLE_SHEETS_ID` (если используете интеграцию с Google Sheets)
   - `GOOGLE_SERVICE_ACCOUNT` (для доступа к Google Sheets)

2. Запустите приложение:
   - Нажмите на вкладку "Start application" в панели Workflows

## Особенности настройки

### Ключевые слова и настройки поведения

Python-версия бота использует несколько списков ключевых слов для определения реакции на сообщения:

#### 1. Медицинские и организационные ключевые слова (`TRIGGER_KEYWORDS`)

Бот реагирует на эти слова в групповых чатах:

```python
TRIGGER_KEYWORDS = [
    # Медицинские термины
    "спина", "позвоночник", "давление", "зуб", "стоматолог", "миома"...
    
    # Организационные вопросы
    "цена", "стоимость", "тур", "записаться", "клиника"...
]
```

#### 2. Слова для запроса контактов (`CONTACT_KEYWORDS`)

При обнаружении этих слов бот автоматически покажет WhatsApp-контакты операторов:

```python
CONTACT_KEYWORDS = ["контакт", "оператор", "связаться", "телефон", "позвонить", 
                    "номер", "написать", "вацап", "ватсап", "whatsapp"...]
```

#### 3. Приветствия и неинформативные сообщения (`GREETING_KEYWORDS`)

На такие сообщения бот не отвечает в группах, а в личных чатах предлагает задать конкретный вопрос:

```python
GREETING_KEYWORDS = ["привет", "здравствуй", "здравствуйте", "добрый день", 
                     "хай", "как дела", "ку", "наталья", "спасибо"...]
```

### OpenAI API

Бот настроен на использование модели GPT-4o. Системная инструкция задает тон и формат ответов.

### WhatsApp интеграция

Бот предоставляет удобные ссылки на WhatsApp для связи с операторами:

1. При запуске бота командой `/start` выводятся контакты с кликабельными ссылками
2. Через команду `/contacts` можно в любой момент получить список контактов
3. При обнаружении запроса контактов в сообщении, бот автоматически предложит список операторов
4. К каждому ответу бота добавляется кнопка "Связаться с оператором", ведущая на контакты
5. При нажатии на контакт открывается WhatsApp с подготовленным чатом с выбранным оператором

Формат WhatsApp-ссылок: `https://wa.me/НОМЕР_БЕЗ_ПЛЮСА`

### Интеграция с сайтом hunchun.ru

Бот активно продвигает официальный сайт клиники:

1. Упоминает сайт hunchun.ru в ответах на вопросы пользователей
2. Добавляет кнопку "Подробнее на hunchun.ru" ко всем ответам
3. Включает кнопку с ссылкой на сайт в клавиатуру с контактами операторов
4. Рекомендует посетить сайт для получения дополнительной информации по ценам, клиникам и методам лечения
5. Настраивает модель OpenAI, чтобы она упоминала сайт в ответах на вопросы

### Управление контекстом диалога

Бот сохраняет контекст общения с пользователем:

1. Запоминает имя пользователя при первом знакомстве
2. Распознает имя, если оно указано в сообщении
3. Обращается к пользователю по имени при приветствии и в ответах
4. Отслеживает темы, которые интересуют пользователя (например, похудение)
5. Передает контекстную информацию в запросы к OpenAI для персонализации ответов
6. Имеет специализированные ответы для популярных тем (похудение, лечение спины)
7. Сохраняет состояние диалога между перезапусками бота

Пример работы с контекстом:
```
Пользователь: "Маша"
Бот: "Приятно познакомиться, Маша! Как я могу помочь вам с лечением в Китае?"
Пользователь: "Хочу похудеть"
Бот: "Программы похудения в Хуньчуне сочетают диету, массаж и китайскую медицину для быстрого результата ⚡ Фото до и после, а также описание методик на hunchun.ru. Приезжайте в Хуньчунь - минус 5-7 кг за 2 недели!"
```

### Google Sheets (для TypeScript-версии)

Для работы с Google Sheets необходимо:
1. Создать сервисный аккаунт Google и получить JSON с ключами
2. Добавить ID таблицы Google Sheets в переменную окружения
3. Предоставить доступ к таблице для email сервисного аккаунта

## Контакты операторов

- Наталья (+94764836278) - общие вопросы
- Алина (+7 968 167-40-07) - экскурсии/косметология/женское здоровье/снижение веса
- Катерина (+7 902 523-48-03) - мужское здоровье/гастро/спина/колени